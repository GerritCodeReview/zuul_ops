This is a work in progress.

Eventually, this repo will be self-deploying, but it is currently in
the process of being bootstrapped.

Manual steps for bootstrapping:

kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# The following must be adapted for your GCE user id
# kubectl create clusterrolebinding $USER-cluster-admin-binding --clusterrole=cluster-admin --user=$USER

kubectl patch svc argocd-server -n argocd -p '{"spec": {"type": "LoadBalancer"}}'

# This gets the name of the argo pod
kubectl get pods -n argocd -l app.kubernetes.io/name=argocd-server -o name | cut -d'/' -f 2

# Use the IP address of the load balancer
argocd login $IP
# Update the admin password (by default, it's the name of the pod above)
argocd account update-password

# Install zookeeper
argocd app create zookeeper \
  --repo http://storage.googleapis.com/kubernetes-charts-incubator \
  --helm-chart zookeeper \
  --revision 2.1.3 \
  --dest-server https://kubernetes.default.svc \
  --dest-namespace zookeeper

argocd app sync zookeeper

# Install nodepool

kubectl create namespace zuul
kubectl apply -n argocd -f nodepool-app.yaml
