{
  "comments": [
    {
      "key": {
        "uuid": "677486a8_2ed4202b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 3
      },
      "lineNbr": 0,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-05-15T13:46:33Z",
      "side": 1,
      "message": "Thanks again James for the clarifications. Apologies Edwin for hijacking your change comments, but it was useful for understanding how Zuul works from a real-life example scenario.",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e1f3a90e_026450c2",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-05-15T06:43:52Z",
      "side": 1,
      "message": "[optional] The checks plugin is also not a core plugin, so it may be moved down to the other section too.",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "c24f419b_03aaf228",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-05-15T10:52:23Z",
      "side": 1,
      "message": "Correct. It can be done as a follow-up change though.",
      "parentUuid": "e1f3a90e_026450c2",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d3be572c_acee4163",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-05-15T11:17:09Z",
      "side": 1,
      "message": "OK, then let\u0027s submit this.",
      "parentUuid": "c24f419b_03aaf228",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "48bf6b1c_41652231",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-05-15T11:24:42Z",
      "side": 1,
      "message": "I believe I misunderstood how Zuul works with the Depends-On: I thought it was equivalent to the Gerrit topics and it would have tested both together.\n\nInstead is just an indication on the order of submission? I am still quite a notice user of Zuul.",
      "parentUuid": "d3be572c_acee4163",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5ac80520_4e593a9b",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2020-05-15T11:29:05Z",
      "side": 1,
      "message": "See comment from James at [1]:\n\n\"Luca, see the \"Depends-On\" change in the commit message, that\u0027s the change that will let Zuul know about the new project.  Unfortunately, that sort of change is one where we update the config file for the system and reload it, so it\u0027s not one that Zuul can dynamically evaluate.  We\u0027ll have to merge it first before this one will succeed.\"\n\nI read this as, Zuul normally respects the \"Depends-On\" footers, but this is a special case because we are changing the config which requires a system reload. Hence the changes need to be submitted in order.\n\n[1] https://gerrit-review.googlesource.com/c/zuul/config/+/267314/1/zuul.d/projects.yaml#81",
      "parentUuid": "48bf6b1c_41652231",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c762523d_f98a9822",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1087826
      },
      "writtenOn": "2020-05-15T13:11:10Z",
      "side": 1,
      "message": "Yes, that\u0027s it exactly.",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1d90e1aa_f46ebbc9",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-05-15T13:12:10Z",
      "side": 1,
      "message": "Thanks, Edwin. That means that the Depends-On was misplaced in this case, as Zuul would have no way to respect the dependency. Normally, instead, it should behave like the topic submission, right?\n\n@James if it wasn\u0027t for the Zuul restart needed, would the topic have worked as well? (assuming that we add both the topic and the Depends-On).\n\nI was thinking about the causes were we really need this in our Gerrit development lifecycle and how to automate the generation of \"Depends-On\" automatically based on the topic, or the other way around.\n\nWhen Zuul is used as a gating process, we do not need the topic because Zuul is going to submit the change anyway, so he will respect the Depends-On. For our use-case, instead, we do need the topic because we want to make sure that we merge *ONLY IF* all the dependent changes are mergeable and green.",
      "parentUuid": "5ac80520_4e593a9b",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "b6598424_d86832b8",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1087826
      },
      "writtenOn": "2020-05-15T13:38:57Z",
      "side": 1,
      "message": "Zuul always respects Depends-On for changes it knows about, but depending on the circumstances, the behavior may be slightly different.  If change B Depends-On: change A, then:\n\n* Zuul will never merge change B unless change A is merged.  This requires a gate pipeline, which we don\u0027t have here, so at the moment, we won\u0027t observe this behavior.\n* Zuul will never enqueue change B into a gate pipeline unless change A is either merged or is enqueued ahead of it.  This also obviously requires a gate pipeline.\n* If the changes are both for untrusted projects (the list starting here at line 15), then Zuul will check out change A when it tests change B, so change B can depend on a code change in A, or even a Zuul configuration change.  We can observe this behavior in a check pipeline like we have in this system.\n\nZuul only supports an acyclic graph for change dependencies at the moment, meaning that it is strictly ordered.  Since this Gerrit has submit-whole-topic enabled, that\u0027s a slightly different behavior than what Zuul does.  There is work in progress to support cyclic dependencies and therefore  simultaneous testing and merging of changes as a group, which would match the submit-whole-topic behavior, but that is not yet complete.\n\nI think it might be interesting in this situation to experiment with using both as you suggest -- Depends-On to ensure that Zuul tests related changes together, and a topic to ensure they aren\u0027t submitted until they are all ready.",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9616d1f2_64ce0302",
        "filename": "zuul/main.yaml",
        "patchSetId": 3
      },
      "lineNbr": 20,
      "author": {
        "id": 1006192
      },
      "writtenOn": "2020-05-15T13:46:33Z",
      "side": 1,
      "message": "\u003e Zuul always respects Depends-On for changes it knows about, but depending on the circumstances, the behavior may be slightly different.  If change B Depends-On: change A, then:\n\u003e \n\u003e * Zuul will never merge change B unless change A is merged.  This requires a gate pipeline, which we don\u0027t have here, so at the moment, we won\u0027t observe this behavior.\n\u003e * Zuul will never enqueue change B into a gate pipeline unless change A is either merged or is enqueued ahead of it.  This also obviously requires a gate pipeline.\n\nYep, that was my understanding as well. I may also start adopting the gate pipeline in the future, but we would need to have higher mileage of the Zuul change validation pipeline. We have still a gap on Docker and Chrome validations at the moment, but I am sure we can get there :-)\n\n\u003e * If the changes are both for untrusted projects (the list starting here at line 15), then Zuul will check out change A when it tests change B, so change B can depend on a code change in A, or even a Zuul configuration change.  We can observe this behavior in a check pipeline like we have in this system.\n\nCool, that\u0027s exactly what we would need. Imagine that I need a change on Gerrit core (e.g. InstanceId we are development right now) and a corresponding change on a plugin that uses it (e.g. multi-site): then Zuul would be able to get the right versions and validate them together.\n\nIf we automate the generation of a topic, we would also make sure that they are merged together.\n\n\u003e I think it might be interesting in this situation to experiment with using both as you suggest -- Depends-On to ensure that Zuul tests related changes together, and a topic to ensure they aren\u0027t submitted until they are all ready.\n\nYes, maybe from Depends-On to topic would be easier. (e.g. zuul-\u003cUUID\u003e).",
      "parentUuid": "b6598424_d86832b8",
      "revId": "9016bd7bdf11e9878633c79f28c4cc4dbfd67ed8",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153",
      "unresolved": false
    }
  ]
}